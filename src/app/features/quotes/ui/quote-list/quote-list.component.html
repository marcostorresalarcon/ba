<section class="rounded-[2.5rem] border border-fog/60 bg-white/95 p-6 shadow-brand mt-5">
  <div class="mb-4 flex items-center justify-between">
    <div>
      <p class="text-xs font-semibold uppercase tracking-[0.35em] text-clay">Estimates</p>
      <div class="mt-1 flex items-center gap-3">
        <h2 class="font-display text-2xl text-charcoal">Project Estimates</h2>
        <span class="rounded-full bg-sand/70 px-3 py-1 text-xs font-semibold text-charcoal/80">
          {{ getProjectTypeLabel() }}
        </span>
      </div>
    </div>
    @if (!readonly) {
    <button
      type="button"
      class="inline-flex items-center gap-2 rounded-full bg-pine px-4 py-2 text-sm font-semibold text-white shadow-raised transition hover:bg-pine-dark"
      (click)="createQuote.emit()"
    >
      <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      New Estimate
    </button>
    }
  </div>

  @if (isLoading) {
  <div class="space-y-3">
    @for (_ of [1, 2, 3]; track $index) {
    <div class="h-16 rounded-2xl bg-fog/30"></div>
    }
  </div>
  } @else { @if (quotes.length === 0) {
  <div class="rounded-2xl border-2 border-dashed border-fog bg-sand/30 p-8 text-center">
    <p class="text-sm font-medium text-charcoal">No estimates yet.</p>
    <p class="mt-1 text-xs text-slate">Create the first estimate for this project.</p>
  </div>
  } @else {
  <div class="space-y-3">
    @for (quote of quotes; track trackById($index, quote)) {
    <div
      class="group flex items-center justify-between rounded-2xl border border-fog/60 bg-white px-5 py-4 shadow-sm transition hover:border-pine/40 hover:shadow-raised cursor-pointer"
      [routerLink]="['/quotes', quote._id]"
    >
      <div class="flex-1">
        <div class="flex items-center gap-3">
          <span class="rounded-full bg-pine/10 px-3 py-1 text-xs font-semibold text-pine">
            {{ getCategoryLabel(quote.category) }}
          </span>
          @if (projectType) {
          <span class="rounded-full bg-sand/40 px-3 py-1 text-xs font-medium text-charcoal">
            {{ getProjectTypeLabel() }}
          </span>
          }
          <span
            class="rounded-full px-2.5 py-0.5 text-xs font-medium"
            [ngClass]="getStatusColor(quote.status)"
          >
            {{ quote.status.replace('_', ' ') }}
          </span>
          <span class="rounded-full bg-clay/10 px-2.5 py-0.5 text-xs font-semibold text-clay">
            v{{ quote.versionNumber }}
          </span>
        </div>
        <div class="mt-2 flex items-center gap-4">
          <p class="text-base font-semibold text-charcoal">
            @if (quote.totalPrice) {
              ${{ quote.totalPrice.toLocaleString() }}
            } @else {
              <span class="text-slate">N/A</span>
            }
          </p>
        </div>
        @if (quote.notes) {
        <p class="mt-1 text-sm text-slate line-clamp-1">{{ quote.notes }}</p>
        }
      </div>
      <div class="ml-4 flex items-center gap-3">
        <div class="text-xs text-slate">
          @if (quote.createdAt) {
          {{ formatDate(quote.createdAt) }}
          }
        </div>
        @if (!readonly) {
        <div class="flex items-center gap-2">
          <button
            type="button"
            class="inline-flex items-center gap-1.5 rounded-lg bg-blue-500/10 px-3 py-1.5 text-xs font-medium text-blue-600 transition hover:bg-blue-500/20"
            (click)="onViewInvoices(quote, $event)"
            title="View Invoices"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Invoices
          </button>
          <button
            type="button"
            class="inline-flex items-center gap-1.5 rounded-lg bg-pine/10 px-3 py-1.5 text-xs font-medium text-pine transition hover:bg-pine/20"
            (click)="onEditQuote(quote, $event)"
            title="Create new version"
          >
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            New Version
          </button>
          <button
            type="button"
            class="inline-flex items-center gap-1.5 rounded-lg bg-red-500/10 px-3 py-1.5 text-xs font-medium text-red-600 transition hover:bg-red-500/20"
            (click)="onDeleteQuote(quote, $event)"
            title="Delete estimate"
          >
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
            Delete
          </button>
        </div>
        }
      </div>
    </div>
    }
  </div>
  } }
</section>
